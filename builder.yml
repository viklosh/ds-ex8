---
- name: Install docker
  hosts: img-builder
  become: yes

  tasks:
  - name: Ensure docker package is present.
    apt:
      name: docker.io
      state: present

  - name: Create build directory
    file:
      path: ~/app
      state: directory
      owner: root
      group: root
      mode: '0755'

  - name: Copy Dockerfile
    copy:
      src: ./Dockerfile
      dest: ~/app
      owner: root
      group: root
      mode: '0644'

  # - name: Build image
  #   docker_image:
  #     name: boxfuse:latest
  #     build:
  #       path: ~/app
  #       source: build
  #     state: present
  
  - name: Build an image and push it to docker hub.
    docker_image:
      build:
        path: ~/app
      name: viklosh/boxfuse:latest
      push: yes
      source: build

#       - name: pull an image
#   docker_image:
#     name: pacur/centos-7
#     source: pull

# - name: Tag and push to docker hub
#   docker_image:
#     name: pacur/centos-7:56
#     repository: dcoppenhagan/myimage:7.56
#     push: yes
#     source: local
